{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\siwar\\\\Desktop\\\\front\\\\src\\\\user\\\\components\\\\videoChat\\\\pages\\\\meetings\\\\Meeting.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef, useContext } from \"react\";\nimport queryString from \"query-string\";\nimport Peer from \"simple-peer\";\nimport \"./Meeting.css\"; // context\n\nimport { useDataLayerValue } from \"../../contexts/DataLayer\";\nimport { SocketIoContext } from \"../../contexts/SocketContext\"; // components\n\nimport Navbar from \"../../components/navbar/Navbar\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst videoConstraints = {\n  height: \"100%\",\n  width: \"100%\"\n}; // -------------------------------- Child Component ---------------------------------------\n\nconst Video = ({\n  peer\n}) => {\n  _s();\n\n  const ref = useRef();\n  useEffect(() => {\n    peer.on(\"stream\", stream => {\n      ref.current.srcObject = stream;\n    });\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"video\", {\n    className: \"video\",\n    ref: ref,\n    autoPlay: true,\n    style: {\n      marginRight: \"1000px\",\n      marginTop: \"150px\",\n      minWidth: \"700px\",\n      minHeight: \"815px\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 29,\n    columnNumber: 10\n  }, this);\n}; // --------------------------------- Parent Component ---------------------------------------\n\n\n_s(Video, \"8uVE59eA/r6b92xF80p7sH8rXLk=\");\n\n_c = Video;\n\nconst Meeting = ({\n  location\n}) => {\n  _s2();\n\n  // state\n  const [muted, setMuted] = useState(false);\n  const [showVideo, setShowVideo] = useState(true); // contexts\n\n  const [state, dispatch] = useDataLayerValue();\n  const {\n    socket\n  } = useContext(SocketIoContext); // peers\n\n  const [peers, setPeers] = useState([]); // use refs\n\n  const socketRef = useRef();\n  const userVideo = useRef();\n  const peersRef = useRef([]);\n  const roomIdRef = useRef();\n  const myVideoStream = useRef();\n  useEffect(() => {\n    // get the user data\n    const name = \"profile.name\";\n    const imageUrl = \"profile.profile_img\"; // get the room data\n\n    const query = queryString.parse(location.search);\n    const roomName = query.room;\n    roomIdRef.current = query.roomId; // connect with server\n\n    socketRef.current = socket; // get the user media\n\n    navigator.mediaDevices.getUserMedia({\n      video: videoConstraints,\n      audio: true\n    }).then(stream => {\n      // set my video src\n      userVideo.current.srcObject = stream; // getting my video access\n\n      myVideoStream.current = stream; // interact with server\n\n      socketRef.current.emit(\"join user\", {\n        roomID: roomIdRef.current,\n        roomName,\n        name,\n        imageUrl\n      });\n      socketRef.current.on(\"all users\", userInThisRoom => {\n        console.log(userInThisRoom); // add all users to the reducer\n\n        dispatch({\n          type: \"ADD_ALL_USERS\",\n          users: userInThisRoom\n        });\n        const peers = []; // send the signal to all users in this room\n\n        userInThisRoom.forEach(user => {\n          // create New Peer\n          const peer = createNewPeer(user.userId, socketRef.current.id, stream); // push the peer\n\n          peersRef.current.push({\n            peerId: user.userId,\n            peer // peer : peer\n\n          });\n          peers.push({\n            peerId: user.userId,\n            peer\n          });\n        }); // set all the peers into to state\n\n        setPeers(peers);\n      }); // =========== new user join =======\n\n      socketRef.current.on(\"user join\", (callerId, signal, callerData) => {\n        console.log(\"new user joined !!\", callerId, callerData); // add the callerdata to the reducer\n\n        dispatch({\n          type: \"ADD_ALL_USERS\",\n          users: [callerData]\n        });\n        const peer = addPeer(callerId, signal, stream); // push the peer\n\n        peersRef.current.push({\n          peerId: callerId,\n          peer\n        });\n        const peerObj = {\n          peerId: callerId,\n          peer\n        };\n        console.log(\"peerObj\", peerObj, peers); // set the state without changing others value\n\n        setPeers(peers => [...peers, peerObj]);\n      }); // ============= recieving signal =============\n\n      socketRef.current.on(\"recieving returning signal\", ({\n        signal,\n        id\n      }) => {\n        const item = peersRef.current.find(peer => peer.peerId === id); // peering caller signal\n\n        item.peer.signal(signal);\n      });\n      console.log(\"peers\", peers); // =============== user left ==================\n\n      socketRef.current.on(\"user left\", id => {\n        // getting the peerObj from ref\n        const peerObj = peersRef.current.find(peer => peer.peerId === id); // destroy the peer\n\n        if (peerObj) {\n          peerObj.peer.destroy();\n        }\n\n        console.log(\"before\", peers); // set the peer\n\n        const peer = peersRef.current.filter(peer => peer.peerId !== id);\n        peersRef.current = peer;\n        setPeers(peer);\n        console.log(\"after\", peers);\n      });\n    });\n  }, []);\n  console.log(\"Peers\", peers); // ==================== craete new peer ===============\n\n  function createNewPeer(userToSignal, callerId, stream) {\n    console.log(\"hey hey\");\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream\n    });\n    peer.on(\"signal\", signal => {\n      socketRef.current.emit(\"sending signal\", {\n        userToSignal,\n        callerId,\n        signal,\n        roomID: roomIdRef.current\n      });\n    });\n    return peer;\n  } // =================== add new peer =========================\n\n\n  function addPeer(callerId, incomingSignal, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream\n    });\n    peer.on(\"signal\", signal => {\n      socketRef.current.emit(\"returning signal\", {\n        callerId,\n        signal\n      });\n    });\n    peer.signal(incomingSignal);\n    return peer;\n  } //share screen \n  // mute\n\n\n  async function sharescreen() {\n    let captureStream = null;\n\n    try {\n      captureStream = await navigator.mediaDevices.getDisplayMedia();\n      userVideo.current.srcObject = captureStream;\n    } catch (err) {\n      console.error(\"Error: \" + err);\n    }\n\n    console.log(captureStream);\n  } // mute\n\n\n  const muteAudio = () => {\n    let audio = myVideoStream.current.getAudioTracks()[0].enabled;\n\n    if (audio) {\n      setMuted(true);\n      myVideoStream.current.getAudioTracks()[0].enabled = false;\n      document.getElementById(\"micro\").name = \"mic-off-circle-outline\";\n    } else {\n      setMuted(false);\n      myVideoStream.current.getAudioTracks()[0].enabled = true;\n      document.getElementById(\"micro\").name = \"mic-circle-outline\";\n    }\n\n    console.log(muted);\n  }; // leave function\n\n\n  const leaveFunction = () => {\n    if (window.confirm('Are you sure you want to exit this video call ?')) {\n      socket.disconnect();\n      window.close();\n    } else {}\n  }; // show video\n\n\n  const showVideoFunc = () => {\n    let video = myVideoStream.current.getVideoTracks()[0].enabled;\n\n    if (video) {\n      setShowVideo(false);\n      myVideoStream.current.getVideoTracks()[0].enabled = false;\n      document.getElementById(\"video\").name = \"videocam-off-outline\";\n    } else {\n      setShowVideo(true);\n      myVideoStream.current.getVideoTracks()[0].enabled = true;\n      document.getElementById(\"video\").name = \"videocam-outline\";\n    }\n\n    console.log(showVideo);\n  }; // =================== render here ==========================\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"meeting__page d-flex flex-column\",\n    style: {\n      backgroundColor: \"black\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(Navbar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container-fluid pt-4 pb-3 mt-5 flex-fill d-flex overflow-hidden\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"meeting__box overflow-hidden h-100 flex-wrap flex-fill d-flex justify-content-center align-items-center position-relative\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"vedio__box p-1 d-flex justify-content-center\",\n          children: /*#__PURE__*/_jsxDEV(\"video\", {\n            className: \"video\",\n            ref: userVideo,\n            autoPlay: true,\n            muted: true,\n            style: {\n              maxWidth: \"200px\",\n              position: \"absolute\",\n              marginTop: \"750px\",\n              zIndex: 30\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 11\n        }, this), peers.map(peer => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"vedio__box p-1 d-flex justify-content-center\",\n          children: /*#__PURE__*/_jsxDEV(Video, {\n            peer: peer.peer\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 15\n          }, this)\n        }, peer.peerId, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: muteAudio,\n          style: {\n            maxWidth: \"200px\",\n            position: \"absolute\",\n            marginTop: \"600px\",\n            marginRight: \"140px\"\n          },\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"ion-icon\", {\n            name: \"mic-circle-outline\",\n            id: \"micro\",\n            style: {\n              color: \"white\",\n              fontSize: \"50px\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 132\n          }, this), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: showVideoFunc,\n          style: {\n            maxWidth: \"200px\",\n            position: \"absolute\",\n            marginTop: \"600px\",\n            marginRight: \"290px\"\n          },\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"ion-icon\", {\n            name: \"videocam-outline\",\n            id: \"video\",\n            style: {\n              color: \"white\",\n              fontSize: \"50px\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 135\n          }, this), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: sharescreen,\n          style: {\n            maxWidth: \"200px\",\n            position: \"absolute\",\n            marginTop: \"600px\",\n            marginRight: \"440px\"\n          },\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"ion-icon\", {\n            name: \"desktop-outline\",\n            style: {\n              color: \"white\",\n              fontSize: \"50px\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 133\n          }, this), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: leaveFunction,\n          style: {\n            maxWidth: \"200px\",\n            position: \"absolute\",\n            marginTop: \"600px\",\n            marginRight: \"590px\"\n          },\n          children: [\" \", /*#__PURE__*/_jsxDEV(\"ion-icon\", {\n            name: \"exit-outline\",\n            style: {\n              color: \"white\",\n              fontSize: \"50px\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 135\n          }, this), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 252,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(Meeting, \"7QZLxd004K774YcrB1diCglTy/A=\", false, function () {\n  return [useDataLayerValue];\n});\n\n_c2 = Meeting;\nexport default Meeting;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Video\");\n$RefreshReg$(_c2, \"Meeting\");","map":{"version":3,"sources":["C:/Users/siwar/Desktop/front/src/user/components/videoChat/pages/meetings/Meeting.js"],"names":["React","useState","useEffect","useRef","useContext","queryString","Peer","useDataLayerValue","SocketIoContext","Navbar","videoConstraints","height","width","Video","peer","ref","on","stream","current","srcObject","marginRight","marginTop","minWidth","minHeight","Meeting","location","muted","setMuted","showVideo","setShowVideo","state","dispatch","socket","peers","setPeers","socketRef","userVideo","peersRef","roomIdRef","myVideoStream","name","imageUrl","query","parse","search","roomName","room","roomId","navigator","mediaDevices","getUserMedia","video","audio","then","emit","roomID","userInThisRoom","console","log","type","users","forEach","user","createNewPeer","userId","id","push","peerId","callerId","signal","callerData","addPeer","peerObj","item","find","destroy","filter","userToSignal","initiator","trickle","incomingSignal","sharescreen","captureStream","getDisplayMedia","err","error","muteAudio","getAudioTracks","enabled","document","getElementById","leaveFunction","window","confirm","disconnect","close","showVideoFunc","getVideoTracks","backgroundColor","maxWidth","position","zIndex","map","color","fontSize"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, useContext } from \"react\";\r\nimport queryString from \"query-string\";\r\nimport Peer from \"simple-peer\";\r\nimport \"./Meeting.css\";\r\n\r\n// context\r\nimport { useDataLayerValue } from \"../../contexts/DataLayer\";\r\nimport { SocketIoContext } from \"../../contexts/SocketContext\";\r\n\r\n// components\r\nimport Navbar from \"../../components/navbar/Navbar\";\r\n\r\n\r\nconst videoConstraints = {\r\n  height: \"100%\",\r\n  width: \"100%\",\r\n};\r\n\r\n// -------------------------------- Child Component ---------------------------------------\r\nconst Video = ({ peer }) => {\r\n  const ref = useRef();\r\n\r\n  useEffect(() => {\r\n    peer.on(\"stream\", (stream) => {\r\n      ref.current.srcObject = stream;\r\n    });\r\n  }, []);\r\n\r\n  return <video className=\"video\" ref={ref} autoPlay style={{marginRight:\"1000px\",marginTop:\"150px\",minWidth:\"700px\",minHeight:\"815px\"}} />;\r\n};\r\n\r\n// --------------------------------- Parent Component ---------------------------------------\r\nconst Meeting = ({ location }) => {\r\n  // state\r\n  const [muted, setMuted] = useState(false);\r\n  const [showVideo, setShowVideo] = useState(true);\r\n\r\n  // contexts\r\n  const [state, dispatch] = useDataLayerValue();\r\n  const { socket } = useContext(SocketIoContext);\r\n  // peers\r\n  const [peers, setPeers] = useState([]);\r\n  // use refs\r\n  const socketRef = useRef();\r\n  const userVideo = useRef();\r\n  const peersRef = useRef([]);\r\n  const roomIdRef = useRef();\r\n  const myVideoStream = useRef();\r\n\r\n  useEffect(() => {\r\n    // get the user data\r\n \r\n    const name = \"profile.name\";\r\n    const imageUrl = \"profile.profile_img\";\r\n    // get the room data\r\n    const query = queryString.parse(location.search);\r\n    const roomName = query.room;\r\n    roomIdRef.current = query.roomId;\r\n    // connect with server\r\n    socketRef.current = socket;\r\n    // get the user media\r\n    navigator.mediaDevices\r\n      .getUserMedia({ video: videoConstraints, audio: true })\r\n      .then((stream) => {\r\n        // set my video src\r\n        userVideo.current.srcObject = stream;\r\n        // getting my video access\r\n        myVideoStream.current = stream;\r\n        // interact with server\r\n        socketRef.current.emit(\"join user\", {\r\n          roomID: roomIdRef.current,\r\n          roomName,\r\n          name,\r\n          imageUrl,\r\n        });\r\n        socketRef.current.on(\"all users\", (userInThisRoom) => {\r\n          console.log(userInThisRoom);\r\n          // add all users to the reducer\r\n          dispatch({\r\n            type: \"ADD_ALL_USERS\",\r\n            users: userInThisRoom,\r\n          });\r\n          const peers = [];\r\n          // send the signal to all users in this room\r\n          userInThisRoom.forEach((user) => {\r\n            // create New Peer\r\n            const peer = createNewPeer(\r\n              user.userId,\r\n              socketRef.current.id,\r\n              stream\r\n            );\r\n            // push the peer\r\n            peersRef.current.push({\r\n              peerId: user.userId,\r\n              peer, // peer : peer\r\n            });\r\n            peers.push({\r\n              peerId: user.userId,\r\n              peer,\r\n            });\r\n          });\r\n          // set all the peers into to state\r\n          setPeers(peers);\r\n        });\r\n        // =========== new user join =======\r\n        socketRef.current.on(\"user join\", (callerId, signal, callerData) => {\r\n          console.log(\"new user joined !!\", callerId, callerData);\r\n          // add the callerdata to the reducer\r\n          dispatch({\r\n            type: \"ADD_ALL_USERS\",\r\n            users: [callerData],\r\n          });\r\n          const peer = addPeer(callerId, signal, stream);\r\n          // push the peer\r\n          peersRef.current.push({\r\n            peerId: callerId,\r\n            peer,\r\n          });\r\n          const peerObj = {\r\n            peerId: callerId,\r\n            peer,\r\n          };\r\n          console.log(\"peerObj\", peerObj, peers);\r\n          // set the state without changing others value\r\n          setPeers((peers) => [...peers, peerObj]);\r\n        });\r\n\r\n        // ============= recieving signal =============\r\n        socketRef.current.on(\"recieving returning signal\", ({ signal, id }) => {\r\n          const item = peersRef.current.find((peer) => peer.peerId === id);\r\n          // peering caller signal\r\n          item.peer.signal(signal);\r\n        });\r\n\r\n        console.log(\"peers\", peers);\r\n\r\n        // =============== user left ==================\r\n        socketRef.current.on(\"user left\", (id) => {\r\n          // getting the peerObj from ref\r\n          const peerObj = peersRef.current.find((peer) => peer.peerId === id);\r\n          // destroy the peer\r\n          if (peerObj) {\r\n            peerObj.peer.destroy();\r\n          }\r\n          console.log(\"before\", peers);\r\n          // set the peer\r\n          const peer = peersRef.current.filter((peer) => peer.peerId !== id);\r\n          peersRef.current = peer;\r\n          setPeers(peer);\r\n\r\n          console.log(\"after\", peers);\r\n        });\r\n      });\r\n  }, []);\r\n\r\n  console.log(\"Peers\", peers);\r\n\r\n  // ==================== craete new peer ===============\r\n  function createNewPeer(userToSignal, callerId, stream) {\r\n    console.log(\"hey hey\");\r\n    const peer = new Peer({\r\n      initiator: true,\r\n      trickle: false,\r\n      stream,\r\n    });\r\n\r\n    peer.on(\"signal\", (signal) => {\r\n      socketRef.current.emit(\"sending signal\", {\r\n        userToSignal,\r\n        callerId,\r\n        signal,\r\n        roomID: roomIdRef.current,\r\n      });\r\n    });\r\n\r\n    return peer;\r\n  }\r\n\r\n  // =================== add new peer =========================\r\n  function addPeer(callerId, incomingSignal, stream) {\r\n    const peer = new Peer({\r\n      initiator: false,\r\n      trickle: false,\r\n      stream,\r\n    });\r\n\r\n    peer.on(\"signal\", (signal) => {\r\n      socketRef.current.emit(\"returning signal\", { callerId, signal });\r\n    });\r\n\r\n    peer.signal(incomingSignal);\r\n\r\n    return peer;\r\n  }\r\n  //share screen \r\n   // mute\r\n  async function sharescreen () {\r\n    let captureStream = null;\r\n\r\n  try {\r\n    captureStream = await navigator.mediaDevices.getDisplayMedia();\r\n    userVideo.current.srcObject=captureStream;\r\n    \r\n  } catch(err) {\r\n    console.error(\"Error: \" + err);\r\n  }\r\n  console.log (captureStream);\r\n}\r\n\r\n  // mute\r\n  const muteAudio = () => {\r\n    let audio = myVideoStream.current.getAudioTracks()[0].enabled;\r\n    if (audio) {\r\n      setMuted(true);\r\n      myVideoStream.current.getAudioTracks()[0].enabled = false;\r\n      document.getElementById(\"micro\").name = \"mic-off-circle-outline\";\r\n    } else {\r\n      setMuted(false);\r\n      myVideoStream.current.getAudioTracks()[0].enabled = true;\r\n      document.getElementById(\"micro\").name = \"mic-circle-outline\";\r\n    }\r\n    console.log(muted);\r\n  };\r\n   // leave function\r\n   const leaveFunction = () => {\r\n    if (window.confirm('Are you sure you want to exit this video call ?')) {\r\n      socket.disconnect();\r\n      window.close()  ;\r\n    } else {\r\n  \r\n    }\r\n  \r\n  };\r\n\r\n  // show video\r\n  const showVideoFunc = () => {\r\n    let video = myVideoStream.current.getVideoTracks()[0].enabled;\r\n    if (video) {\r\n      setShowVideo(false);\r\n      myVideoStream.current.getVideoTracks()[0].enabled = false;\r\n      document.getElementById(\"video\").name = \"videocam-off-outline\";\r\n        } else {\r\n      setShowVideo(true);\r\n      myVideoStream.current.getVideoTracks()[0].enabled = true;\r\n      document.getElementById(\"video\").name = \"videocam-outline\";\r\n    }\r\n    console.log(showVideo);\r\n  };\r\n\r\n  // =================== render here ==========================\r\n  return (\r\n    <div className=\"meeting__page d-flex flex-column\" style={{backgroundColor:\"black\"}}>\r\n      <Navbar />\r\n \r\n      <div className=\"container-fluid pt-4 pb-3 mt-5 flex-fill d-flex overflow-hidden\">\r\n        <div className=\"meeting__box overflow-hidden h-100 flex-wrap flex-fill d-flex justify-content-center align-items-center position-relative\">\r\n          <div className=\"vedio__box p-1 d-flex justify-content-center\">\r\n            <video  className=\"video\" ref={userVideo} autoPlay muted style={{ maxWidth:\"200px\",position: \"absolute\", marginTop:\"750px\",zIndex:30}}/>\r\n          </div>\r\n          {peers.map((peer) => (\r\n            <div\r\n              key={peer.peerId}\r\n              className=\"vedio__box p-1 d-flex justify-content-center\"\r\n            >\r\n              <Video peer={peer.peer} />\r\n            </div>\r\n          ))}\r\n          {/* control box */}\r\n          <button onClick={muteAudio} style={{ maxWidth:\"200px\",position: \"absolute\", marginTop:\"600px\" , marginRight:\"140px\" }} > <ion-icon name=\"mic-circle-outline\"  id =\"micro\" style={{  color : \"white\" ,  fontSize :\"50px\"}}></ion-icon> </button>\r\n          <button onClick={showVideoFunc} style={{ maxWidth:\"200px\",position: \"absolute\", marginTop:\"600px\",  marginRight:\"290px\"}} > <ion-icon name=\"videocam-outline\"  id =\"video\" style={{  color : \"white\" ,  fontSize :\"50px\"}}></ion-icon> </button>\r\n          <button onClick={sharescreen} style={{ maxWidth:\"200px\",position: \"absolute\", marginTop:\"600px\" , marginRight:\"440px\"}} > <ion-icon name=\"desktop-outline\" style={{  color : \"white\" ,  fontSize :\"50px\"}}></ion-icon> </button>\r\n          <button onClick={leaveFunction} style={{ maxWidth:\"200px\",position: \"absolute\", marginTop:\"600px\" , marginRight:\"590px\"}} > <ion-icon name=\"exit-outline\" style={{  color : \"white\" ,  fontSize :\"50px\"}}></ion-icon> </button>\r\n\r\n        </div>\r\n    \r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Meeting;\r\n"]},"metadata":{},"sourceType":"module"}