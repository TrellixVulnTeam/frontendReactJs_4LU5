{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/chaki/OneDrive/Desktop/aymenouerghui/frontendReactJs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/chaki/OneDrive/Desktop/aymenouerghui/frontendReactJs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:/Users/chaki/OneDrive/Desktop/aymenouerghui/frontendReactJs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/chaki/OneDrive/Desktop/aymenouerghui/frontendReactJs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"C:/Users/chaki/OneDrive/Desktop/aymenouerghui/frontendReactJs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:/Users/chaki/OneDrive/Desktop/aymenouerghui/frontendReactJs/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nvar _jsxFileName = \"C:\\\\Users\\\\chaki\\\\OneDrive\\\\Desktop\\\\aymenouerghui\\\\frontendReactJs\\\\src\\\\user\\\\components\\\\screens\\\\VideoInput.js\";\nimport React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport Webcam from 'react-webcam';\nimport { loadModels, getFullFaceDescription, createMatcher } from '../../../api/face';\nimport axios from \"axios\"; // Import face profile\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar JSON_PROFILE = \"\";\nvar WIDTH = 420;\nvar HEIGHT = 420;\nvar inputSize = 160;\n\nvar VideoInput = /*#__PURE__*/function (_Component) {\n  _inherits(VideoInput, _Component);\n\n  var _super = _createSuper(VideoInput);\n\n  function VideoInput(props) {\n    var _this;\n\n    _classCallCheck(this, VideoInput);\n\n    _this = _super.call(this, props);\n    _this.componentWillMount = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              axios.get('https://aaweni.herokuapp.com/helloworld.json').then(function (response) {\n                JSON_PROFILE = response.data;\n              }).catch(function (error) {\n                console.log(error);\n              });\n              _context.next = 3;\n              return loadModels();\n\n            case 3:\n              _context.t0 = _this;\n              _context.next = 6;\n              return createMatcher(JSON_PROFILE);\n\n            case 6:\n              _context.t1 = _context.sent;\n              _context.t2 = {\n                faceMatcher: _context.t1\n              };\n\n              _context.t0.setState.call(_context.t0, _context.t2);\n\n              _this.setInputDevice();\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.setInputDevice = function () {\n      navigator.mediaDevices.enumerateDevices().then( /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(devices) {\n          var inputDevice;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.next = 2;\n                  return devices.filter(function (device) {\n                    return device.kind === 'videoinput';\n                  });\n\n                case 2:\n                  inputDevice = _context2.sent;\n\n                  if (!(inputDevice.length < 2)) {\n                    _context2.next = 8;\n                    break;\n                  }\n\n                  _context2.next = 6;\n                  return _this.setState({\n                    facingMode: 'user'\n                  });\n\n                case 6:\n                  _context2.next = 10;\n                  break;\n\n                case 8:\n                  _context2.next = 10;\n                  return _this.setState({\n                    facingMode: {\n                      exact: 'environment'\n                    }\n                  });\n\n                case 10:\n                  _this.startCapture();\n\n                case 11:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n    };\n\n    _this.startCapture = function () {\n      _this.interval = setInterval(function () {\n        _this.capture();\n      }, 1500);\n    };\n\n    _this.capture = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var match, _yield$axios$post, data;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!_this.webcam.current) {\n                _context3.next = 24;\n                break;\n              }\n\n              _context3.next = 3;\n              return getFullFaceDescription(_this.webcam.current.getScreenshot(), inputSize).then(function (fullDesc) {\n                if (!!fullDesc) {\n                  _this.setState({\n                    detections: fullDesc.map(function (fd) {\n                      return fd.detection;\n                    }),\n                    descriptors: fullDesc.map(function (fd) {\n                      return fd.descriptor;\n                    })\n                  });\n                }\n              });\n\n            case 3:\n              if (!(!!_this.state.descriptors && !!_this.state.faceMatcher)) {\n                _context3.next = 24;\n                break;\n              }\n\n              _context3.next = 6;\n              return _this.state.descriptors.map(function (descriptor) {\n                return _this.state.faceMatcher.findBestMatch(descriptor);\n              });\n\n            case 6:\n              match = _context3.sent;\n\n              _this.setState({\n                match: match\n              });\n\n              if (!(match[0]._label.length > 8)) {\n                _context3.next = 23;\n                break;\n              }\n\n              _context3.prev = 9;\n              _context3.next = 12;\n              return axios.post(\"https://aaweni.herokuapp.com/api/auth/getpassword/\" + match[0]._label);\n\n            case 12:\n              _yield$axios$post = _context3.sent;\n              data = _yield$axios$post.data;\n              localStorage.setItem(\"authToken\", data.token);\n              window.location.href = \"https://3aweni.netlify.app/\";\n              _context3.next = 21;\n              break;\n\n            case 18:\n              _context3.prev = 18;\n              _context3.t0 = _context3[\"catch\"](9);\n              setTimeout(function () {}, 5000);\n\n            case 21:\n              _context3.next = 24;\n              break;\n\n            case 23:\n              console.log(\"mekech maarouf\");\n\n            case 24:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[9, 18]]);\n    }));\n    _this.webcam = /*#__PURE__*/React.createRef();\n    _this.state = {\n      fullDesc: null,\n      detections: null,\n      descriptors: null,\n      faceMatcher: null,\n      match: null,\n      facingMode: null\n    };\n    return _this;\n  }\n\n  _createClass(VideoInput, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      clearInterval(this.interval);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          detections = _this$state.detections,\n          match = _this$state.match,\n          facingMode = _this$state.facingMode;\n      var videoConstraints = null;\n      var camera = '';\n\n      if (!!facingMode) {\n        videoConstraints = {\n          width: WIDTH,\n          height: HEIGHT,\n          facingMode: facingMode\n        };\n\n        if (facingMode === 'user') {\n          camera = 'Front';\n        } else {\n          camera = 'Back';\n        }\n      }\n\n      var drawBox = null;\n\n      if (!!detections) {\n        drawBox = detections.map(function (detection, i) {\n          var _H = detection.box.height;\n          var _W = detection.box.width;\n          var _X = detection.box._x;\n          var _Y = detection.box._y;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                position: 'absolute',\n                border: 'solid',\n                borderColor: 'blue',\n                height: _H,\n                width: _W,\n                transform: \"translate(\".concat(_X, \"px,\").concat(_Y, \"px)\")\n              },\n              children: !!match && !!match[i] ? /*#__PURE__*/_jsxDEV(\"p\", {\n                style: {\n                  backgroundColor: 'blue',\n                  border: 'solid',\n                  borderColor: 'blue',\n                  width: _W,\n                  marginTop: 0,\n                  color: '#fff',\n                  transform: \"translate(-3px,\".concat(_H, \"px)\")\n                },\n                children: match[i]._label\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 156,\n                columnNumber: 17\n              }, _this2) : null\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 145,\n              columnNumber: 13\n            }, _this2)\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 11\n          }, _this2);\n        });\n      }\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"Camera\",\n        style: {\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Camera: \", camera]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: WIDTH,\n            height: HEIGHT\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: 'relative',\n              width: WIDTH\n            },\n            children: [!!videoConstraints ? /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                position: 'absolute'\n              },\n              children: /*#__PURE__*/_jsxDEV(Webcam, {\n                audio: false,\n                width: WIDTH,\n                height: HEIGHT,\n                ref: this.webcam,\n                screenshotFormat: \"image/jpeg\",\n                videoConstraints: videoConstraints\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 195,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 194,\n              columnNumber: 15\n            }, this) : null, !!drawBox ? drawBox : null]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return VideoInput;\n}(Component);\n\nexport default _c = withRouter(VideoInput);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["C:/Users/chaki/OneDrive/Desktop/aymenouerghui/frontendReactJs/src/user/components/screens/VideoInput.js"],"names":["React","Component","withRouter","Webcam","loadModels","getFullFaceDescription","createMatcher","axios","JSON_PROFILE","WIDTH","HEIGHT","inputSize","VideoInput","props","componentWillMount","get","then","response","data","catch","error","console","log","faceMatcher","setState","setInputDevice","navigator","mediaDevices","enumerateDevices","devices","filter","device","kind","inputDevice","length","facingMode","exact","startCapture","interval","setInterval","capture","webcam","current","getScreenshot","fullDesc","detections","map","fd","detection","descriptors","descriptor","state","findBestMatch","match","_label","post","localStorage","setItem","token","window","location","href","setTimeout","createRef","clearInterval","videoConstraints","camera","width","height","drawBox","i","_H","box","_W","_X","_x","_Y","_y","position","border","borderColor","transform","backgroundColor","marginTop","color","display","flexDirection","alignItems"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport Webcam from 'react-webcam';\r\nimport { loadModels, getFullFaceDescription, createMatcher } from '../../../api/face';\r\nimport axios from \"axios\";\r\n\r\n// Import face profile\r\nlet JSON_PROFILE = \"\";\r\n\r\nconst WIDTH = 420;\r\nconst HEIGHT = 420;\r\nconst inputSize = 160;\r\n\r\nclass VideoInput extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.webcam = React.createRef();\r\n    this.state = {\r\n      fullDesc: null,\r\n      detections: null,\r\n      descriptors: null,\r\n      faceMatcher: null,\r\n      match: null,\r\n      facingMode: null\r\n    };\r\n  }\r\n\r\n  componentWillMount = async () => {\r\n   \r\n    axios.get('https://aaweni.herokuapp.com/helloworld.json')\r\n    .then(function (response)   {\r\n  \r\n      JSON_PROFILE = response.data;\r\n  \r\n  \r\n   })\r\n   .catch(function (error) {\r\n     console.log(error);\r\n   });\r\n    \r\n   await loadModels();\r\n   this.setState({ faceMatcher: await createMatcher(JSON_PROFILE) });\r\n   this.setInputDevice();\r\n  };\r\n\r\n  setInputDevice = () => {\r\n    navigator.mediaDevices.enumerateDevices().then(async devices => {\r\n      let inputDevice = await devices.filter(\r\n        device => device.kind === 'videoinput'\r\n      );\r\n      if (inputDevice.length < 2) {\r\n        await this.setState({\r\n          facingMode: 'user'\r\n        });\r\n      } else {\r\n        await this.setState({\r\n          facingMode: { exact: 'environment' }\r\n        });\r\n      }\r\n      this.startCapture();\r\n    });\r\n  };\r\n\r\n  startCapture = () => {\r\n    this.interval = setInterval(() => {\r\n      this.capture();\r\n    }, 1500);\r\n  };\r\n\r\n  componentWillUnmount() {\r\n    clearInterval(this.interval);\r\n  }\r\n\r\n  capture = async () => {\r\n    if (!!this.webcam.current) {\r\n      await getFullFaceDescription(\r\n        this.webcam.current.getScreenshot(),\r\n        inputSize\r\n      ).then(fullDesc => {\r\n        if (!!fullDesc) {\r\n          this.setState({\r\n            detections: fullDesc.map(fd => fd.detection),\r\n            descriptors: fullDesc.map(fd => fd.descriptor)\r\n          });\r\n        }\r\n      });\r\n\r\n      if (!!this.state.descriptors && !!this.state.faceMatcher) {\r\n        let match = await this.state.descriptors.map(descriptor =>\r\n          this.state.faceMatcher.findBestMatch(descriptor)\r\n        );\r\n        this.setState({ match });\r\n      \r\n        if(match[0]._label.length>8){\r\n          \r\n          try {\r\n            const {data} = await axios.post(\r\n              \"https://aaweni.herokuapp.com/api/auth/getpassword/\"+match[0]._label\r\n               );\r\n            localStorage.setItem(\"authToken\", data.token);\r\n            window.location.href = \"https://3aweni.netlify.app/\";\r\n        } catch (error) {\r\n          \r\n            setTimeout(() => {\r\n               \r\n            }, 5000);\r\n        }\r\n         \r\n          }\r\n    else{\r\n      console.log(\"mekech maarouf\");\r\n    }\r\n      }\r\n      \r\n\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { detections, match, facingMode } = this.state;\r\n    let videoConstraints = null;\r\n    let camera = '';\r\n    if (!!facingMode) {\r\n      videoConstraints = {\r\n        width: WIDTH,\r\n        height: HEIGHT,\r\n        facingMode: facingMode\r\n      };\r\n      if (facingMode === 'user') {\r\n        camera = 'Front';\r\n      } else {\r\n        camera = 'Back';\r\n      }\r\n    }\r\n\r\n    let drawBox = null;\r\n    if (!!detections) {\r\n      drawBox = detections.map((detection, i) => {\r\n        let _H = detection.box.height;\r\n        let _W = detection.box.width;\r\n        let _X = detection.box._x;\r\n        let _Y = detection.box._y;\r\n        return (\r\n          <div key={i}>\r\n            <div\r\n              style={{\r\n                position: 'absolute',\r\n                border: 'solid',\r\n                borderColor: 'blue',\r\n                height: _H,\r\n                width: _W,\r\n                transform: `translate(${_X}px,${_Y}px)`\r\n              }}\r\n            >\r\n              {!!match && !!match[i] ? (\r\n                <p\r\n                  style={{\r\n                    backgroundColor: 'blue',\r\n                    border: 'solid',\r\n                    borderColor: 'blue',\r\n                    width: _W,\r\n                    marginTop: 0,\r\n                    color: '#fff',\r\n                    transform: `translate(-3px,${_H}px)`\r\n                  }}\r\n                >\r\n                  {match[i]._label}\r\n                </p>\r\n              ) : null}\r\n            </div>\r\n          </div>\r\n        );\r\n      });\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className=\"Camera\"\r\n        style={{\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          alignItems: 'center'\r\n        }}\r\n      >\r\n        <p>Camera: {camera}</p>\r\n        <div\r\n          style={{\r\n            width: WIDTH,\r\n            height: HEIGHT\r\n          }}\r\n        >\r\n          <div style={{ position: 'relative', width: WIDTH }}>\r\n            {!!videoConstraints ? (\r\n              <div style={{ position: 'absolute' }}>\r\n                <Webcam\r\n                  audio={false}\r\n                  width={WIDTH}\r\n                  height={HEIGHT}\r\n                  ref={this.webcam}\r\n                  screenshotFormat=\"image/jpeg\"\r\n                  videoConstraints={videoConstraints}\r\n                />\r\n              </div>\r\n            ) : null}\r\n            {!!drawBox ? drawBox : null}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(VideoInput);\r\n"]},"metadata":{},"sourceType":"module"}