"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var a=n(e),i=function(e){var n=e.page,i=e.pageHeight,r=e.pageWidth,u=e.rotation,o=e.thumbnailHeight,c=e.thumbnailWidth,g=a.useRef(),s=a.useState(""),h=s[0],p=s[1];return a.useEffect((function(){var e=g.current;e&&e.cancel();var t=document.createElement("canvas"),a=t.getContext("2d",{alpha:!1}),o=c,s=o/(r/i),h=o/r;t.height=s,t.width=o,t.style.height=s+"px",t.style.width=o+"px";var l=n.getViewport({rotation:u,scale:h});g.current=n.render({canvasContext:a,viewport:l}),g.current.promise.then((function(){return p(t.toDataURL())}),(function(){}))}),[u]),h?a.createElement("img",{src:h,height:o+"px",width:c+"px"}):a.createElement(t.Spinner,null)},r=function(e){var n=e.doc,r=e.pageHeight,u=e.pageIndex,o=e.pageWidth,c=e.rotation,g=a.useState({height:r,isCalculated:!1,page:null,viewportRotation:0,width:o}),s=g[0],h=g[1],p=s.isCalculated,l=s.page,d=s.height,f=s.width,m=f/d,b=Math.abs(c)%180==0,v=b?100:100/m,E=b?100/m:100,w=(c+s.viewportRotation)%360,P=t.useIntersectionObserver({onVisibilityChanged:function(e){e.isVisible&&!p&&n.getPage(u+1).then((function(e){var t=e.getViewport({scale:1});h({height:t.height,isCalculated:!0,page:e,viewportRotation:t.rotation,width:t.width})}))}});return a.createElement("div",{className:"rpv-thumbnail-container",ref:P,style:{height:E+"px",width:v+"px"}},l?a.createElement(i,{page:l,pageHeight:b?d:f,pageWidth:b?f:d,rotation:w,thumbnailHeight:E,thumbnailWidth:v}):a.createElement(t.Spinner,null))},u=function(e){var t=e.currentPage,n=e.doc,i=e.pageHeight,u=e.pageWidth,o=e.rotation,c=e.onJumpToPage,g=n.numPages;return a.createElement("div",{className:"rpv-thumbnail-list"},Array(g).fill(0).map((function(e,g){var s,h,p;return a.createElement("div",{key:"thumbnail-"+g,onClick:function(){return c(g)}},a.createElement("div",{className:(s={},s["rpv-thumbnail-item"]=!0,s["rpv-thumbnail-item-selected"]=t===g,h=s,p=[],Object.keys(h).forEach((function(e){e&&h[e]&&p.push(e)})),p.join(" "))},a.createElement(r,{doc:n,pageHeight:i,pageIndex:g,pageWidth:u,rotation:o})))})))},o=function(e){var n=e.store,i=a.useState(n.get("doc")),r=i[0],o=i[1],c=a.useState(n.get("currentPage")||0),g=c[0],s=c[1],h=a.useState(n.get("pageHeight")||0),p=h[0],l=h[1],d=a.useState(n.get("pageWidth")||0),f=d[0],m=d[1],b=a.useState(n.get("rotation")||0),v=b[0],E=b[1],w=function(e){s(e)},P=function(e){o(e)},x=function(e){l(e)},H=function(e){m(e)},W=function(e){E(e)};return a.useEffect((function(){return n.subscribe("doc",P),n.subscribe("pageHeight",x),n.subscribe("pageWidth",H),n.subscribe("rotation",W),function(){n.unsubscribe("doc",P),n.unsubscribe("pageHeight",x),n.unsubscribe("pageWidth",H),n.unsubscribe("rotation",W)}}),[]),t.useIsomorphicLayoutEffect((function(){return n.subscribe("currentPage",w),function(){n.unsubscribe("currentPage",w)}}),[]),r?a.createElement(u,{currentPage:g,doc:r,pageHeight:p,pageWidth:f,rotation:v,onJumpToPage:function(e){var t=n.get("jumpToPage");t&&t(e)}}):a.createElement("div",{className:"rpv-thumbnail-list-loader"},a.createElement(t.Spinner,null))};exports.thumbnailPlugin=function(){var e=a.useMemo((function(){return t.createStore({})}),[]);return{install:function(t){e.update("jumpToPage",t.jumpToPage)},onDocumentLoad:function(t){e.update("doc",t.doc)},onViewerStateChange:function(t){return e.update("currentPage",t.pageIndex),e.update("pageHeight",t.pageHeight),e.update("pageWidth",t.pageWidth),t},Thumbnails:function(){return a.createElement(o,{store:e})}}};
